<html>
	<head>
		<!-- <meta http-equiv="refresh" content="1" /> -->
		<link rel="icon" href="data:,">
		<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-zoom/2.0.1/chartjs-plugin-zoom.min.js"></script>
		<style>
			/* .chart-wrapper {
				height: 950px;
				width: 1920px;
			}

			p {
			margin-top: 15px;
			} */
		</style>
		<script>
			function doFilter() {
				console.log('here');
				window.location.href = '/{{ticker}}?from_time=' + document.getElementById('from_time').value + '&to_time=' + document.getElementById('to_time').value;
			}
		</script>
	</head>

	{% for key, value in data.items() %}
	<div class="chart-wrapper">
		<h2>{{key}} |
			<input type="text" id="from_time" value="" size="3" />
			<input type="text" id="to_time" value="" size="3" />
			<button type="button" id="range_button" onclick="doFilter()">Select</button>
			<a href="{{key}}?bm=-1">Today</a> |
			<a href="{{key}}?bm=0">Open</a> |
			<a href="{{key}}?bm=60">60 minutes</a> |
			<a href="{{key}}?bm=45">45 minutes</a> |
			<a href="{{key}}?bm=30">30 minutes</a> |
			<a href="{{key}}?bm=15">15 minutes</a> |
			<a href="{{key}}?bm=10">10 minutes</a> |
			<a href="{{key}}?bm=5">5 minutes</a> |
			<a href="{{key}}?bm=1">2 minutes</a> |
			<a href="{{key}}?bm=1">1 minute</a>
		</h2>
		<canvas id="{{key}}"></canvas>
	</div>
	<script>
		const ctx = document.getElementById('{{key}}');

// Chart.plugins.register({
//    beforeInit: function(chart) {
//       chart.options.scales.yAxes[0].ticks.suggestedMin = Math.min.apply(this, chart.data.datasets[0].data);
//       chart.options.scales.yAxes[1].ticks.suggestedMax = Math.max.apply(this, chart.data.datasets[0].data);
//    }
// });

		new Chart(ctx, {
			type: 'line',
			data: {
				labels: {{value['labels']|safe}},
				datasets: [
					{
						label: 'bid',
						data: {{value['bids']}},
						borderWidth: 1,
						yAxisID: 'y1',
						borderColor: "green",
						// borderDash: [5, 5],
						// backgroundColor: "#e755ba",
						// pointBackgroundColor: "#55bae7",
						// pointBorderColor: "#55bae7",
						// pointHoverBackgroundColor: "#55bae7",
						// pointHoverBorderColor: "#55bae7",
					},
					{
						label: 'ask',
						data: {{value['asks']}},
						borderWidth: 1,
						yAxisID: 'y1',
						borderColor: "red",
					},
					{
						label: 'last',
						data: {{value['lasts']}},
						borderWidth: 1,
						yAxisID: 'y1',
						borderColor: "#FFC300",
					},
				]
			},
			options: {
				responsive: true,
				stacked: true,
				//maintainAspectRatio: false,
    			animation: {
        			duration: 0
    			},
				plugins: {
					title: {
						display: true,
						text: '{{key}}'
					}
				},
				scales: {
					y: {
						type: 'linear',
						position: 'left',
						// min: 33,
						// max: 35,
						display: false,
						grid: {
							drawOnChartArea: false
						}
					},
					y1: {
						type: 'linear',
						position: 'right',
						// min: 33,
						// max: 35,
						// grid: {
						// 	display: false
						// }
					},
					// yAxes: [{
					// 		id: 'y',
					// 		type: 'linear',
					// 		position: 'left',
					// 		display: false,
					// 	}, {
					// 		id: 'y1',
					// 		type: 'linear',
					// 		position: 'right',
					// 		grid: {
					// 			display: false
					// 		}
					// }],
				},
				plugins: {
					zoom: {
						pan: {
							enabled: false,
							mode: 'xy',
						},
						zoom: {
							wheel: {
								enabled: true,
							},
							pinch: {
								enabled: true
							},
							drag: {
								enabled: true
							},
							mode: 'xy',
						},
					}
				},
			},
  		});
	</script>
	{% endfor %}
</html>